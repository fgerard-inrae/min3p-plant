!*****Revision Informations Automatically Generated by VisualSVN*****!
!---------------------------------------------------------------------
!> $ID:$
!> $Revision: 850 $
!> $Author: dsu $
!> $Date: 2023-01-27 08:58:23 -0800 (Fri, 27 Jan 2023) $
!> $URL: https://min3psvn.ubc.ca/svn/min3p_thcm/branches/dsu_new_add_2024Jan/src/version/writeversion.F90 $
!---------------------------------------------------------------------
!********************************************************************!

!> module: writeversion
module writeversion

use Version

implicit none

    contains
    
    !>
    !> get version information
    !>
    subroutine initwriteversion

      implicit none

      BuildLabelVersion = trim(MajorVersionNumber)//'.'//              &
                          trim(MinorVersionNumber)//'.'//              &
                          trim(PatchVersionNumber)//'.'//            &
                          trim(GlobalRevisionNumber)
                          

!> Platform information   
      BuildLabelMode = ""
#ifdef DEBUG_WIN32
      BuildLabelMode = "Debug_Win32"
#elif DEBUG_X64
      BuildLabelMode = "Debug_X64"
#elif RELEASE_WIN32
      BuildLabelMode = "Release_Win32"
#elif RELEASE_X64
      BuildLabelMode = "Release_X64"
#else
      BuildLabelMode = "NOT DEFINED"
#endif
        
!> System and default solver WS209
      BuildLabelSystem = ""
#ifdef WINDOWS
      BuildLabelSystem = "Windows"
#elif LINUX
      BuildLabelSystem = "Linux"
#else
      BuildLabelSystem = "Default"
#endif

!> Solver
      BuildLabelSolver = "WS209"
#ifdef PARDISO
      BuildLabelSolver = trim(BuildLabelSolver) //" + Pardiso"
#endif

#ifdef PETSC
      BuildLabelSolver = trim(BuildLabelSolver) //" + PETSc"
#endif

#ifdef LIS
      BuildLabelSolver = trim(BuildLabelSolver) //" + LIS"
#endif

!> Parallel library
      BuildLabelParallel = "Sequential"
#ifdef OPENMP
      BuildLabelParallel = trim(BuildLabelParallel) // " + OpenMP"
#endif

#ifdef PETSC
      BuildLabelParallel = trim(BuildLabelParallel) // " + MPI"
#endif

#ifdef HYBRID
      BuildLabelParallel = trim(BuildLabelParallel) // " + Hybrid"
#endif

!> Main schedule method
      BuildLabelSchedule = "Auto"
#ifdef OPENMP
#ifdef SCHEDULE_DYNAMIC
      BuildLabelSchedule = "Dynamic"
#elif SCHEDULE_STATIC
      BuildLabelSchedule = "Static"
#else
      BuildLabelSchedule = "Auto"
#endif
#endif

    end subroutine initwriteversion

    !> write version information to file
    !> iunit: file unit
    !> strcomment: comment characters
    subroutine writeversion2file(iunit, strcomment)

      implicit none

      integer, intent(in)          :: iunit        !file unit
      character(len=*), intent(in) :: strcomment   !comment characters
      character(2048)              :: strBuildLabel

      write(iunit, "(2a)") trim(adjustl(strcomment)), "Program     : MIN3P-HPC"

      write(iunit, "(3a)") trim(adjustl(strcomment)), "Version     : ",trim(BuildLabelVersion)

      write(iunit, "(3a)") trim(adjustl(strcomment)), "Commit date : ", trim(CommitDate)

      write(iunit, "(3a)") trim(adjustl(strcomment)), "Build date  : ", trim(BuildDate)

      write(iunit, "(3a)") trim(adjustl(strcomment)), "Repository  : ", trim(RepositoryURL)

!> Platform information
      write(iunit, "(3a)") trim(adjustl(strcomment)), "Platform    : ", trim(BuildLabelMode)

!> System and default solver WS209
      write(iunit, "(3a)") trim(adjustl(strcomment)), "System      : ", trim(BuildLabelSystem)

!> Solver
      write(iunit, "(3a)") trim(adjustl(strcomment)), "Solver      : ", trim(BuildLabelSolver)

!> Parallel library
      write(iunit, "(3a)") trim(adjustl(strcomment)), "Parallel    : ", trim(BuildLabelParallel)

!> Main schedule method
#ifdef OPENMP
      write(iunit, "(3a)") trim(adjustl(strcomment)), "Schedule    : ", trim(BuildLabelSchedule)
#endif
    
    end subroutine writeversion2file

end module writeversion

