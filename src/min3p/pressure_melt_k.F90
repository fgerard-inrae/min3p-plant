!*****Revision Informations Automatically Generated by VisualSVN*****!
!---------------------------------------------------------------------
!> $ID:$
!> $Revision: 850 $
!> $Author: dsu $
!> $Date: 2023-01-27 08:58:23 -0800 (Fri, 27 Jan 2023) $
!> $URL: https://min3psvn.ubc.ca/svn/min3p_thcm/branches/dsu_new_add_2024Jan/src/min3p/pressure_melt_k.F90 $
!---------------------------------------------------------------------
!********************************************************************!

!c ----------------------------------------------------------------------
!c subroutine pressure_melt_k
!c -------------------
!c
!c compute pressure melting point based on specified pressure
!c 
!c
!c written by:      Danyang Su - Jul 13, 2022
!c
!c last modified:   Danyang Su - Jul 13, 2022
!c
!c definition of variables:
!c
!c I --> on input   * arbitrary  - initialized  + entries expected
!c O --> on output  * arbitrary  - unaltered    + altered
!c                                                                    I O
!c passed:   integer:
!c           -------
!c           ivol                   = index of control volume         + -
!c
!c           real*8:
!c           tempk                  = temperature in Kelvin           * +
!c
!c      
!c
!c          example
!c          Polynomial Regression Data Fit https://arachnoid.com/polysolve/
!c
!c          Data reference
!c          https://en.wikipedia.org/wiki/Pressure_melting_point#/media/File:Phase_diagram_of_water.svg
!c          https://www.engineeringtoolbox.com/water-melting-temperature-point-pressure-d_2005.html
!c --------------------------------------------------------------------
!c          [MPa]       [Â°C]
!c          0.000612    0.01
!c          0.1         0.0026
!c          1          -0.064
!c          2          -0.14
!c          5          -0.37
!c          10         -0.75
!c          15         -1.14
!c          20         -1.54
!c          30         -2.36
!c          40         -3.21
!c          50         -4.09
!c          60         -5
!c          70         -5.94
!c          80         -6.91
!c          90         -7.91
!c          100        -8.94
!c          120        -11.09
!c          140        -13.35
!c          160        -15.73
!c          180        -18.22
!c          200        -20.83
!c          209.9      -21.985
!c
!c          Mode: normal x,y analysis
!c          Polynomial degree 2, 22 x,y data pairs.
!c          Correlation coefficient = 0.9999802449645417
!c          Standard error = 0.032489754471823194
!c          
!c          Output form: undefined:
!c          
!c               2.0386686217529482e-002,
!c              -7.5378757435889204e-002,
!c              -1.4282322339642163e-004
!c --------------------------------------------------------------------
!c          [MPa]       [Â°C]
!c          350.1      -16.986
!c          632.4      -0.16
!c          2216.0     81.85
!c          10000.0    336.85
!c
!c          Mode: normal x,y analysis
!c          Polynomial degree 2, 4 x,y data pairs.
!c          Correlation coefficient = 0.9999936091137871
!c          Standard error = 0.5060604326504939
!c          
!c          Output form: undefined:
!c          
!c              -3.6624914712156666e+001,
!c               5.8109222533862068e-002,
!c              -2.0762056600305041e-006
!c ----------------------------------------------------------------------

  function pressure_melt_k(ivol,pressure) result(tempk)

    use phys, only : dens_h2o
    use dens, only : density_dependence
    use gen, only : gacc, uvsnew, water_freezing_tempkel,              &
                    b_pressure_melting, rank
  
    implicit none
    
    integer, intent(in) :: ivol
    real*8, intent(in) :: pressure
    real*8 :: tempk
    real*8, parameter :: a1 = -1.4282322339642163d-4,                  &
                         b1 = -7.5378757435889204d-2,                  &
                         c1 = 2.0386686217529482d-2,                   &
                         a2 = -2.0762056600305041d-6,                  &
                         b2 = 5.8109222533862068d-2,                   &
                         c2 = -3.6624914712156666d1,                   &
                         pressure_a = 0.000612d0,                      &
                         pressure_b = 209.9d0,                         &
                         temp_a = 0.01d0, pa2mpa = 1.0d6,              & 
                         tconv_kelvin = 273.15d0, r0 = 0.0d0
    !c local variables
    real*8 :: pressure_mpa

    pressure_mpa = r0

    if (.not.b_pressure_melting) then
      tempk = water_freezing_tempkel
      return
    end if

    if (ivol > 0) then
      pressure_mpa = pressure_mpa + uvsnew(ivol)/pa2mpa
    end if
      
    pressure_mpa = pressure_mpa + pressure/pa2mpa

    if (.not.density_dependence) then
      pressure_mpa = pressure_mpa*dens_h2o*gacc
    end if

    if (pressure_mpa <= pressure_a) then
      tempk = temp_a
    else if (pressure_mpa <= pressure_b) then
      tempk = a1*pressure_mpa*pressure_mpa + b1*pressure_mpa + c1
    else
      tempk = a2*pressure_mpa*pressure_mpa + b2*pressure_mpa + c2
    end if

    tempk = tempk + tconv_kelvin
 
  end function pressure_melt_k
