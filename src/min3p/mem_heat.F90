!*****Revision Informations Automatically Generated by VisualSVN*****!
!---------------------------------------------------------------------
!> $ID:$
!> $Revision: 826 $
!> $Author: dsu $
!> $Date: 2022-03-24 10:10:16 -0700 (Thu, 24 Mar 2022) $
!> $URL: https://min3psvn.ubc.ca/svn/min3p_thcm/branches/dsu_new_add_2024Jan/src/min3p/mem_heat.F90 $
!---------------------------------------------------------------------
!********************************************************************!

!c -----------------------------------------------------------------------
!c subroutine mem_heat
!c ----------------- 
!c Sergio Andres Bea Jofre (2009)
!c
!c last modified:   -
!c
!c                  Danyang Su - Sept. 10, 2018
!c                  Unstructured grid and HPC capabilities
!c ----------------------------------------------------------------------
  
      subroutine mem_heat 
       
      use parm
      use gen
      use chem
      use dens
      use phys, only : is_cell_based_disp_heat
#ifdef OPENMP
      use omp_lib 
#endif

#ifdef USG
      use usg_mesh_data, only : num_cells
#endif

      implicit none
      
      integer :: ierr

      external checkerr
      

      allocate (tempnew(nngl), stat = ierr)
      tempnew=0.0d0
      call checkerr(ierr,'tempnew',ilog)
      call memory_monitor(sizeof(tempnew),'tempnew',.true.)

      
      allocate (tempold(nngl), stat = ierr)
      tempold=0.0d0
      call checkerr(ierr,'tempold',ilog)
      call memory_monitor(sizeof(tempold),'tempold',.true.)


      allocate (heatcaps(nngl), stat = ierr)
      heatcaps=0.0d0
      call checkerr(ierr,'heatcaps',ilog)
      call memory_monitor(sizeof(heatcaps),'heatcaps',.true.)



#ifdef USG
      if (discretization_type > 0 .and. is_cell_based_disp_heat) then
        allocate (heatcondw(num_cells,3), stat = ierr)
        heatcondw=0.0d0
        call checkerr(ierr,'heatcondw',ilog)
        call memory_monitor(sizeof(heatcondw),'heatcondw',.true.)

        allocate (heatconds(num_cells,3), stat = ierr)
        heatconds=0.0d0
        call checkerr(ierr,'heatconds',ilog)
        call memory_monitor(sizeof(heatconds),'heatconds',.true.)

        allocate (heatcondi(num_cells,3), stat = ierr)
        heatcondi=0.0d0
        call checkerr(ierr,'heatcondi',ilog)
        call memory_monitor(sizeof(heatcondi),'heatcondi',.true.)
      else
#endif
        allocate (heatcondw(nngl,3), stat = ierr)
        heatcondw=0.0d0
        call checkerr(ierr,'heatcondw',ilog)
        call memory_monitor(sizeof(heatcondw),'heatcondw',.true.)

        allocate (heatconds(nngl,3), stat = ierr)
        heatconds=0.0d0
        call checkerr(ierr,'heatconds',ilog)
        call memory_monitor(sizeof(heatconds),'heatconds',.true.)

        allocate (heatcondi(nngl,3), stat = ierr)
        heatcondi=0.0d0
        call checkerr(ierr,'heatcondi',ilog)
        call memory_monitor(sizeof(heatcondi),'heatcondi',.true.)
#ifdef USG
      end if
#endif


      allocate (denssolid(nngl), stat = ierr)
      denssolid=0.0d0
      call checkerr(ierr,'denssolid',ilog)
      call memory_monitor(sizeof(denssolid),'denssolid',.true.)



#ifdef USG
      if (discretization_type > 0 .and. is_cell_based_disp_heat) then
        allocate (disheatx(num_cells), stat = ierr)
        disheatx=0.0d0
        call checkerr(ierr,'disheatx',ilog)
        call memory_monitor(sizeof(disheatx),'disheatx',.true.)

        allocate (disheaty(num_cells), stat = ierr)
        disheaty=0.0d0
        call checkerr(ierr,'disheaty',ilog)
        call memory_monitor(sizeof(disheaty),'disheaty',.true.)

        allocate (disheatz(num_cells), stat = ierr)
        disheatz=0.0d0
        call checkerr(ierr,'disheatz',ilog)
        call memory_monitor(sizeof(disheatz),'disheatz',.true.)
      else
#endif
        allocate (disheatx(nngl), stat = ierr)
        disheatx=0.0d0
        call checkerr(ierr,'disheatx',ilog)
        call memory_monitor(sizeof(disheatx),'disheatx',.true.)

        allocate (disheaty(nngl), stat = ierr)
        disheaty=0.0d0
        call checkerr(ierr,'disheaty',ilog)
        call memory_monitor(sizeof(disheaty),'disheaty',.true.)

        allocate (disheatz(nngl), stat = ierr)
        disheatz=0.0d0
        call checkerr(ierr,'disheatz',ilog)
        call memory_monitor(sizeof(disheatz),'disheatz',.true.)

#ifdef USG
      end if
#endif


      if (discretization_type == 0) then
        allocate (heatflux_a(ncon-1), stat = ierr)
        heatflux_a=0.0d0
        call checkerr(ierr,'heatflux_a',ilog)
        call memory_monitor(sizeof(heatflux_a),'heatflux_a',.true.)

        allocate (heatflux_c(ncon-1), stat = ierr)
        heatflux_c=0.0d0
        call checkerr(ierr,'heatflux_c',ilog)
        call memory_monitor(sizeof(heatflux_c),'heatflux_c',.true.)

        allocate (heatflux_d(ncon-1), stat = ierr)
        heatflux_d=0.0d0
        call checkerr(ierr,'heatflux_d',ilog)
        call memory_monitor(sizeof(heatflux_d),'heatflux_d',.true.)

        allocate (vsfluxheat(ncon-1), stat = ierr)
        vsfluxheat=0.0d0
        call checkerr(ierr,'vsfluxheat',ilog)
        call memory_monitor(sizeof(vsfluxheat),'vsfluxheat',.true.)

        allocate (dcoefheat(ncon-1), stat = ierr)
        dcoefheat=0.0d0
        call checkerr(ierr,'dcoefheat',ilog)
        call memory_monitor(sizeof(dcoefheat),'dcoefheat',.true.)

        allocate (del_temp(ncon-1), stat = ierr)
        del_temp=0.0d0
        call checkerr(ierr,'del_temp',ilog)
        call memory_monitor(sizeof(del_temp),'del_temp',.true.)

#ifdef USG
      else
        allocate (heatflux_a(ncon_usg-1), stat = ierr)
        heatflux_a=0.0d0
        call checkerr(ierr,'heatflux_a',ilog)
        call memory_monitor(sizeof(heatflux_a),'heatflux_a',.true.)

        allocate (heatflux_c(ncon_usg-1), stat = ierr)
        heatflux_c=0.0d0
        call checkerr(ierr,'heatflux_c',ilog)
        call memory_monitor(sizeof(heatflux_c),'heatflux_c',.true.)

        allocate (heatflux_d(ncon_usg-1), stat = ierr)
        heatflux_d=0.0d0
        call checkerr(ierr,'heatflux_d',ilog)
        call memory_monitor(sizeof(heatflux_d),'heatflux_d',.true.)

        allocate (vsfluxheat(ncon_usg-1), stat = ierr)
        vsfluxheat=0.0d0
        call checkerr(ierr,'vsfluxheat',ilog)
        call memory_monitor(sizeof(vsfluxheat),'vsfluxheat',.true.)

        allocate (dcoefheat(ncon_usg-1), stat = ierr)
        dcoefheat=0.0d0
        call checkerr(ierr,'dcoefheat',ilog)
        call memory_monitor(sizeof(dcoefheat),'dcoefheat',.true.)

        allocate (del_temp(ncon_usg-1), stat = ierr)
        del_temp=0.0d0
        call checkerr(ierr,'del_temp',ilog)
        call memory_monitor(sizeof(del_temp),'del_temp',.true.)
#endif
      end if



!c  data structure and solver - energy balance 
      if (decoupled_type_vs_heat > 1) then
        allocate (iafheat(nngl+1), stat = ierr)
        iafheat=0
        call checkerr(ierr,'iafheat',ilog)
        call memory_monitor(sizeof(iafheat),'iafheat',.true.)

        allocate (iafdheat(nngl), stat = ierr)
        iafdheat=0 
        call checkerr(ierr,'iafdheat',ilog)
        call memory_monitor(sizeof(iafdheat),'iafdheat',.true.)

        allocate (lorderheat(nngl), stat = ierr)
        lorderheat=0 
        call checkerr(ierr,'lorderheat',ilog)
        call memory_monitor(sizeof(lorderheat),'lorderheat',.true.)

        allocate (invordheat(nngl), stat = ierr)
        invordheat=0 
        call checkerr(ierr,'invordheat',ilog)
        call memory_monitor(sizeof(invordheat),'invordheat',.true.)

        allocate (bheat(nngl), stat = ierr)
        bheat=0 
        call checkerr(ierr,'bheat',ilog)
        call memory_monitor(sizeof(bheat),'bheat',.true.)

        allocate (uheat(nngl), stat = ierr)
        uheat=0 
        call checkerr(ierr,'uheat',ilog)
        call memory_monitor(sizeof(uheat),'uheat',.true.)

        allocate (res_heat(nngl), stat = ierr)
        res_heat=0.0d0
        call checkerr(ierr,'res_heat',ilog)
        call memory_monitor(sizeof(res_heat),'res_heat',.true.)
      else
        allocate (iafglob(2*nngl+1), stat = ierr)
        iafglob=0
        call checkerr(ierr,'iafglob',ilog)
        call memory_monitor(sizeof(iafglob),'iafglob',.true.)

        allocate (iafdglob(2*nngl), stat = ierr)
        iafdglob=0 
        call checkerr(ierr,'iafdglob',ilog)
        call memory_monitor(sizeof(iafdglob),'iafdglob',.true.)

        allocate (lorderglob(2*nngl), stat = ierr)
        lorderglob=0 
        call checkerr(ierr,'lorderglob',ilog)
        call memory_monitor(sizeof(lorderglob),'lorderglob',.true.)

        allocate (invordglob(2*nngl), stat = ierr)
        invordglob=0 
        call checkerr(ierr,'invordglob',ilog)
        call memory_monitor(sizeof(invordglob),'invordglob',.true.)

        allocate (bglob(2*nngl), stat = ierr)
        bglob=0 
        call checkerr(ierr,'bglob',ilog)
        call memory_monitor(sizeof(bglob),'bglob',.true.)

        allocate (uglob(2*nngl), stat = ierr)
        uglob=0 
        call checkerr(ierr,'uglob',ilog)
        call memory_monitor(sizeof(uglob),'uglob',.true.)

        allocate (res_glob(2*nngl), stat = ierr)
        res_glob=0.0d0
        call checkerr(ierr,'res_glob',ilog)
        call memory_monitor(sizeof(res_glob),'res_glob',.true.)
      end if

      if (entalphy_change) then
        allocate (entalchg(nngl), stat = ierr)
        entalchg=0.0d0 
        call checkerr(ierr,'entalchg',ilog)
        call memory_monitor(sizeof(entalchg),'entalchg',.true.)
      end if
      
      return
      end
