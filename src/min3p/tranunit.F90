!*****Revision Informations Automatically Generated by VisualSVN*****!
!---------------------------------------------------------------------
!> $ID:$
!> $Revision: 875 $
!> $Author: dsu $
!> $Date: 2024-01-21 12:55:48 -0800 (Sun, 21 Jan 2024) $
!> $URL: https://min3psvn.ubc.ca/svn/min3p_thcm/branches/dsu_new_add_2024Jan/src/min3p/tranunit.F90 $
!---------------------------------------------------------------------
!********************************************************************!

!c ----------------------------------------------------------------------
!c subroutine tranunit
!c -------------------
!c
!c assign unit numbers for transient data 
!c      
!c written by:      Uli Mayer - February 5, 98 
!c
!c last modified:   Uli Mayer - July 27, 01
!c                  added unit number for flow variables
!c
!c                  Danyang Su - March. 14, 2014
!c                  dynamically allocate unit number
!c
!c definition of variables:
!c
!c I --> on input   * arbitrary  - initialized  + entries expected
!c O --> on output  * arbitrary  - unaltered    + altered
!c 
!c                                                                    I O
!c passed:   integer*4:
!c           ----------
!c           igb                = pointer to current spatial location + -
!c
!c common:   
!c parm.f:   -
!c
!c gen.f:    integer*4:
!c           ----------
!c           igbb               = unit number, concentrations of      * +
!c                                             sorbed species
!c                                             - transient data
!c                                               global system
!c           igbc               = unit number, free species and       * +
!c                                             secondary aqueous
!c                                             species concentrations
!c                                             - transient data
!c                                               global system
!c           igbac              = unit number, activity coefficient   * +
!c                                              - transient data
!c                                                global system
!c           igbd               = unit number, dissolution-           * +
!c                                             precipitation
!c                                             rates
!c                                             - transient data
!c                                               global system
!c           igbg               = unit number, gas concentrations     * +
!c                                             - transient data
!c                                                global system
!c           igbgr              = unit number, degassing rates        * +
!c                                             - transient data
!c                                                global system
!c           igbm               = unit number, master variables       * +
!c                                             - transient data
!c                                               global system
!c           igbi               = unit number, rates of intra-aqueous * +
!c                                             kinetic reactions
!c                                             - transient data
!c                                               global system
!c           igbp               = unit number, flow variables         * +
!c                                             - transient data
!c                                               global system
!c           igbs               = unit number, saturation indices     * +
!c                                             - transient data
!c                                               global system
!c           igbt               = unit number, total aqueous          * +
!c                                             component
!c                                             concentrations
!c                                             - transient data
!c                                               global system
!c           igbv               = unit number, mineral volume         * +
!c                                             fractions
!c                                             - transient data
!c                                               global system
!c           igbx               = unit number, saturation indices     * +
!c                                             excluded minerals
!c                                             - transient data
!c                                               global system
!c
!c
!c chem.f:   integer*4:
!c           ----------
!c           naq                = number of intra-aqueous kinetic     + -
!c                                reactions
!c           ng                 = number of gases                     + -
!c           nm                 = number of minerals                  + -
!c           nmx                = number of excluded minerals         + -
!c           nr                 = number of redox couples             + -
!c           nsb                = number of sorbed species            + -
!c           nsb_ion            = number of sorbed species            + -
!c                                (ion-exchange)
!c           nsb_surf           = number of sorbed species            + -
!c                                (surface-complex)
!c
!c           logical:
!c           --------
!c           gas_removal        = .true.  -> degassing of dissolved   + -
!c                                           gases, if confining
!c                                           pressure exceeded
!c           noncompetitive_sorption = logical array for activation   + -   
!c                                     of noncompetitive sorption
!c                                     reactions
!c
!c local:    igbinc             = increment for defining file 
!c                                unit numbers
!c
!c external: -
!c ----------------------------------------------------------------------
 
      subroutine tranunit(igb)
 
      use parm
      use gen
      use chem
      use file_unit, only : lun_set
      use mip_bubble, only : mip_mt_enable
      use nobleGasIngrowth, only : b_use_ngi, ngre_i

      implicit none
      
      integer :: igb, igbinc

!c  assign unit numbers for output of transient data

      if (reactive_transport) then
        igbinc = 16                       !!!change this accordingly with new output 
      else
        igbinc = 2
      end if

      igbp = igb_start+igbinc*(igb-1)     !flow variables
      call lun_set(igbp)

      if (root_uptake) then               !root related model
        igbroot = igbp+1
        call lun_set(igbroot)  
      end if

      if (reactive_transport) then
        igbt = igbp+2                     !total concentrations
        call lun_set(igbt)

        igbc = igbp+3                     !species concentrations
        call lun_set(igbc)

        if (ph_output .or. pe_output) then
          igbm = igbp+4                   !master variables
          call lun_set(igbm)
        end if

        if (ng.gt.0) then
          igbg = igbp+5                   !partial gas pressures
          call lun_set(igbg)
        end if

        if (naq.gt.0.or.nr.gt.0) then
          igbi = igbp+6                   !intra-aqueous kinetic reactions
          call lun_set(igbi)
        end if

        if (nsb_ion.gt.0.or.nsb_surf.gt.0.or.noncompetitive_sorption) then                
          igbb = igbp+7                   !sorbed species concentrations
          call lun_set(igbb)
        end if

        if (nm.gt.0) then
          igbs = igbp+8                   !saturation indices
          igbv = igbp+9                   !mineral volume fractions
          igbd = igbp+10                   !reaction rates
          call lun_set(igbs)
          call lun_set(igbv)
          call lun_set(igbd)
        end if

        if (nmx.gt.0) then
          igbx = igbp+11                   !saturation indices
          call lun_set(igbx)
        end if                            !excluded minerals

        if (ng.gt.0) then
          if (gas_removal) then
            igbgr = igbp+12               !degassing rates
            call lun_set(igbgr)
          end if
        end if
        
!c_isotope
        if (iso_output) then              !isotopic fractionation
          igbis = igbp+13
          call lun_set(igbis)
        end if
        
        if (b_output_activity) then
          igbac = igbp+14                !activity coefficients
          call lun_set(igbac)
        end if

        if (mip_mt_enable) then          !MIP_MT bubble formation
          igbmip = igbp+15
          call lun_set(igbmip)
        end if

!cdsu concentration of radioelement related to noble gas ingrowth
        if (b_use_ngi .and. ngre_i > 0) then
          igbre = igbp+16
          call lun_set(igbre)
        end if

      end if

      return
      end
