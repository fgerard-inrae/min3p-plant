!*****Revision Informations Automatically Generated by VisualSVN*****!
!---------------------------------------------------------------------
!> $ID:$
!> $Revision: 875 $
!> $Author: dsu $
!> $Date: 2024-01-21 12:55:48 -0800 (Sun, 21 Jan 2024) $
!> $URL: https://min3psvn.ubc.ca/svn/min3p_thcm/branches/dsu_new_add_2024Jan/src/min3p/mem_nc.F90 $
!---------------------------------------------------------------------
!********************************************************************!

!c -----------------------------------------------------------------------
!c subroutine mem_nc
!c -----------------
!c
!c allocate memory for one-dimensional arrays of size n and nc
!c
!c written by:      Uli Mayer - Januray 6, 2000
!c
!c last modified:   -
!c
!c definition of variables:
!c
!c I --> on input   * arbitrary  - initialized  + entries expected
!c O --> on output  * arbitrary  - unaltered    + altered
!c                                                                    I O
!c passed:   -
!c
!c common:
!c gen.f:    real*8:
!c           -------
!c           delta_c(n)         = actual update in log cycles         * +
!c           delta_c_max(n)     = maximum update in log cycles        * +
!c
!c           integer:
!c           --------
!c           ilog               = unit number, logbook file           + -
!c           n                  = number of components excluding h2o  + -
!c                                equals number of unknowns per
!c                                control volume
!c
!c chem.f:   real*8:
!c           -------
!c           actv(nc)           = activities of components as species * +
!c                                in solution - new time level
!c           alkfacc(nc)        = alkalinity factors for components   * +
!c           ccnew(nc)          = concentrations of components as
!c                                species in solution
!c                                - new time level [moles/l water]
!c           ccold(nc)          = concentrations of components as     * +
!c                                species in solution
!c                                - old time level [moles/l water]
!c           chargec(nc)        = charge of components as species     * +
!c                                in solution
!c           dhac(nc)           = debye-huckel a for components as    * +
!c                                species in solution
!c           dhbc(nc)           = debye-huckel b for components as    * +
!c                                species in solution
!c           gfwc(nc)           = gram formula weight of components   * +
!c           phguess            = guess for pH                        * +
!c           sion1(nthreads)    = ionic strength (local chemistry)    * +
!c           totcmin(nc-1)      = minimum total aqueous component     * +
!c                                concentration in solution domain
!c           totcn(nc-1,nthreads)
!c                              = total aqueous component             * +
!c                                concentrations
!c                                - new time level [moles/l water]
!c           totco(nc-1,nthreads)
!c                              = total aqueous component            * +
!c                                concentrations
!c                                - old time level [moles/l water]
!c           totcinit(nc-1)     = total aqueous component            * +
!c                                concentrations
!c                                - initial concentrations
!c                                [moles/l water]
!c           dtotaq(nc-1,nthreads)       
!c                              = derivative of total source-sink     * +
!c                                term towards total aqueous component
!c                                concentrations due to intra-aqueous
!c                                kinetic reactions
!c           totaq(nc-1,nthreads)
!c                              = total source-sink term towards      * +
!c                                total aqueous component
!c                                concentrations due to intra-aqueous
!c                                kinetic reactions
!c           dtotor(nc-1)       = derivative of total source/sink     * +
!c                                term towards total aqueous
!c                                component concentrations due to
!c                                oxidation-reduction reactions
!c                                [moles/(l bulk*day)]
!c           totor(nc-1)        = total source/sink term towards      * +
!c                                total aqueous component
!c                                concentrations due to
!c                                oxidation-reduction reactions
!c                                [moles/(l bulk*day)]
!c           totgn(nc-1,nthreads)
!c                              = total gaseous component             * +
!c                                concentrations
!c                                - new time level [moles/l air]
!c           totgo(nc-1)        = total gaseous component             * +
!c                                concentrations
!c                                - old time level [moles/l air]
!c           totrateg(nc-1)     = total rate for removal of aqueous   * +
!c                                components due to degassing
!c                                [mol L^-1 s^-1]
!c           totcsn(nc-1)       = total sorbed component              * +
!c                                concentrations
!c                                - new time level [moles/l bulk]
!c           totcsn_ion(nc-1,nthreads) 
!c                              = total sorbed component              + -
!c                                concentrations
!c                                (ion-exchange)
!c           totcsn_surf(nc-1,nthreads)  
!c                              = total sorbed component              + -
!c                                concentrations
!c                                - new time level [moles/l bulk]
!c                                (surface-complex)
!c           totcso(nc-1)       = total sorbed component              * +
!c                                concentrations
!c                                - old time level [moles/l bulk]
!c           totcso_ion(nc-1)   = total sorbed component              * +
!c                                concentrations
!c                                - old time level [moles/l bulk]
!c                                (ion-exchange)
!c           totcso_surf(nc-1)  = total sorbed component              * +
!c                                concentrations
!c                                - old time level [moles/l bulk]
!c                                (surface-complex)
!c           cinc(nc,nthreads)  = incremented concentrations of       * +
!c                                components as species in solution
!c                                [moles/l h2o]
!c           dtotc(n,nthreads)  = derivatives of total aqueous        * +
!c                                component concentrations
!c                                [moles/l h2o]
!c           dtotcf(n,nthreads) = derivatives of total aqueous
!c                                component concentrations
!c                                times porosity correstion 
!c                                factors for hMCD model [moles/l h2o]
!c           dtotdp(n,nthreads) = derivatives of total source/sink    * +
!c                                term towards total aqueous
!c                                component concentrations due to
!c                                mineral dissolution-precipitation
!c                                reactions
!c                                [moles/(l bulk*day)]
!c           dtotg(n)           = derivatives of total gaseous        * +
!c                                component concentrations
!c                                [moles/l air]
!c           dtotsb(n)          = derivatives of total source/sink    * +
!c                                term towards total aqueous
!c                                component concentrations due to
!c                                sorption reactions
!c                                [moles/(l bulk*day)]
!c           dtotsb_ion(n,nthreads)      
!c                              = derivatives of total source/sink    * +
!c                                term towards total aqueous
!c                                component concentrations due to
!c                                sorption reactions
!c                                [moles/(l bulk*day)]
!c                                (ion-exchange)
!c           dtotsb_surf(n,nthreads)     
!c                              = derivatives of total source/sink    * +
!c                                term towards total aqueous
!c                                component concentrations due to
!c                                sorption reactions
!c                                [moles/(l bulk*day)]
!c                                (surface-complex)
!c           dtota(n)           = derivatives of total sorbed         * +
!c                                component concentrations
!c                                (non-competitive sorption)
!c                                [moles/l bulk]
!c           totcinc(n,nthreads)= total aqueous component             * +
!c                                concentrations
!c                                - new time level - incremented
!c                                [moles/l h2o]
!c           totdp(n,nthreads)  = total source/sink term towards      * +
!c                                total aqueous component
!c                                concentrations due to mineral
!c                                dissolution-precipitation
!c                                reactions [moles/(l bulk*day)]
!c           totsb(n)           = total source/sink term towards      * +
!c                                total aqueous component
!c                                concentrations due to sorption
!c                                reactions [moles/(l bulk*day)]
!c           totsb_ion(n)       = total source/sink term towards      * +
!c                                total aqueous component
!c                                concentrations due to sorption
!c                                reactions [moles/(l bulk*day)]
!c                                (ion-exchange)
!c           totsb_surf(n)      = total source/sink term towards      * +
!c                                total aqueous component
!c                                concentrations due to sorption
!c                                reactions [moles/(l bulk*day)]
!c                                (surface-complex)
!c           alc(n,n,nthreads)  = Jacobian matrix                     * +
!c           blc(n,nthreads)    = rhs-vector                          * +
!c
!c           integer:
!c           --------
!c           iais(nc)           = row pointer array for compressed    * +
!c                                storage of surface site data
!c           l_namec(nc)        = length of component names           * +
!c           nc                 = number of components including h2o  + -
!c           ncorder(nc)        = ordering array for components       * +
!c                                ncorder(old order) = new order
!c
!c           character:
!c           ----------
!c           component_type(nc) = 'aqueous' = aqueous component       * +
!c                                'surface' = surface site
!c                                'biomass' = biomass
!c           ctype(nc-1)        = 'charge' = correct total aqueous    * +
!c                                           component concentration
!c                                           for specified component
!c                                           to satisfy charge balance
!c                                'fixed'  = compute total aqueous
!c                                           component concentrations
!c                                           based on fixed activities
!c                                           of components as species
!c                                           in solution
!c                                'free'   = compute concentrations
!c                                           of components as species
!c                                           in solution based on
!c                                           specified total aqueous
!c                                           component concentrations
!c                                'ph'    =  pH specified for 'h+1'
!c           ctype_init(nc-1)   = 'charge' = correct total aqueous    * +
!c                                           component concentration
!c                                           for specified component
!c                                           to satisfy charge balance
!c                                'fixed'  = compute total aqueous
!c                                           component concentrations
!c                                           based on fixed activities
!c                                           of components as species
!c                                           in solution
!c                                'free'   = compute concentrations
!c                                           of components as species
!c                                           in solution based on
!c                                           specified total aqueous
!c                                           component concentrations
!c                                'ph'    =  pH specified for 'h+1'
!c           isotherm_type(nc)  = definition of sorption isotherm     * +
!c                                'none' = no sorption
!c                                'linear' = linear adsorption
!c                                'freundlich' = Freundlich isotherm
!c                                'langmuir' = Langmuir isotherm
!c           namec(nc)          = component names                     * +
!c
!c local:    integer:
!c           --------
!c           ierr               = 0 -> memory allocation successful
!c
!c external: checkerr  = check for error during memory allocation
!c
!c---------------------------------------------------------------------- 
!c WARNING
!c---------------------------------------------------------------------- 
!c All allocated variables are initialized to some value. This depends  
!c of its type:
!c 
!c real*8      => 0.0d0
!c integer     => 0 
!c character   => ' '    
!c logical     => .false. 
!c 
!c Sergio Andres Bea Jofre (2009)
!c
!c ----------------------------------------------------------------------
  
      subroutine mem_nc
 
      use parm
      use gen
      use chem
      use multidiff
      
      implicit none
      
      integer :: ierr
 
      external checkerr

!c  control parameters - local chemistry

      allocate (ncorder(nc), stat = ierr)
      ncorder=0 
      call checkerr(ierr,'ncorder',ilog)
      call memory_monitor(sizeof(ncorder),'ncorder',.true.)

      allocate (component_type(nc), stat = ierr)
      component_type=' ' 
      call checkerr(ierr,'component_type',ilog)
      call memory_monitor(sizeof(component_type),'component_type',.true.)

      allocate (ctype(nc-1), stat = ierr)
      ctype=' ' 
      call checkerr(ierr,'ctype',ilog)
      call memory_monitor(sizeof(ctype),'ctype',.true.)

      allocate (ctype_init(nc-1), stat = ierr)
      ctype_init=' ' 
      call checkerr(ierr,'ctype_init',ilog)
      call memory_monitor(sizeof(ctype_init),'ctype_init',.true.)

!c  main variables - aqueous species

      allocate (actv(nc), stat = ierr)
      actv=0.0d0
      call checkerr(ierr,'actv',ilog)
      call memory_monitor(sizeof(actv),'actv',.true.)

      allocate (alkfacc(nc), stat = ierr)
      alkfacc=0.0d0
      call checkerr(ierr,'alkfacc',ilog)
      call memory_monitor(sizeof(alkfacc),'alkfacc',.true.)

      allocate (totcn(nc-1,nthreads), stat = ierr)
      totcn=0.0d0
      call checkerr(ierr,'totcn',ilog)
      call memory_monitor(sizeof(totcn),'totcn',.true.)

      allocate (totcmin(nc-1), stat = ierr)
      totcmin=0.0d0
      call checkerr(ierr,'totcmin',ilog)
      call memory_monitor(sizeof(totcmin),'totcmin',.true.)

      allocate (totcmin_gbl(nc-1), stat = ierr)
      totcmin_gbl=0.0d0
      call checkerr(ierr,'totcmin_gbl',ilog)
      call memory_monitor(sizeof(totcmin_gbl),'totcmin_gbl',.true.)

      allocate (totco(nc-1,nthreads), stat = ierr)
      totco=0.0d0
      call checkerr(ierr,'totco',ilog)
      call memory_monitor(sizeof(totco),'totco',.true.)

      allocate (totcinit(nc-1), stat = ierr)
      totcinit=0.0d0
      call checkerr(ierr,'totcinit',ilog)
      call memory_monitor(sizeof(totcinit),'totcinit',.true.)

      allocate (ccnew(nc), stat = ierr)
      ccnew=0.0d0
      call checkerr(ierr,'ccnew',ilog)
      call memory_monitor(sizeof(ccnew),'ccnew',.true.)

      allocate (ccold(nc), stat = ierr)
      ccold=0.0d0
      call checkerr(ierr,'ccold',ilog)
      call memory_monitor(sizeof(ccold),'ccold',.true.)

      allocate (chargec(nc), stat = ierr)
      chargec=0.0d0
      call checkerr(ierr,'chargec',ilog)
      call memory_monitor(sizeof(chargec),'chargec',.true.)

      allocate (gfwc(nc), stat = ierr)
      gfwc=0.0d0
      call checkerr(ierr,'gfwc',ilog)
      call memory_monitor(sizeof(gfwc),'gfwc',.true.)

      allocate (dhac(nc), stat = ierr)
      dhac=0.0d0
      call checkerr(ierr,'dhac',ilog)
      call memory_monitor(sizeof(dhac),'dhac',.true.)

      allocate (dhbc(nc), stat = ierr)
      dhbc=0.0d0
      call checkerr(ierr,'dhbc',ilog)
      call memory_monitor(sizeof(dhbc),'dhbc',.true.)

      allocate (l_namec(nc), stat = ierr)
      l_namec=0  
      call checkerr(ierr,'l_namec',ilog)
      call memory_monitor(sizeof(l_namec),'l_namec',.true.)

      allocate (namec(nc), stat = ierr)
      namec=' ' 
      call checkerr(ierr,'namec',ilog)
      call memory_monitor(sizeof(namec),'namec',.true.)

      allocate (delta_totviscnew(nc,nthreads), stat = ierr)        !MCD
      delta_totviscnew=0.0d0
      call checkerr(ierr,'delta_totviscnew',ilog)
      call memory_monitor(sizeof(delta_totviscnew),'delta_totviscnew',.true.)

      allocate (delta_electromignew(nc,nthreads), stat = ierr)     !MCD
      delta_electromignew=0.0d0
      call checkerr(ierr,'delta_electromignew',ilog)
      call memory_monitor(sizeof(delta_electromignew),'delta_electromignew',.true.)

      !allocate (dtotviscnew(nc,nthreads), stat = ierr)          !MCD
      !dtotviscnew=0.0d0
      !call checkerr(ierr,'dtotviscnew',ilog)
      !call memory_monitor(sizeof(dtotviscnew),'dtotviscnew',.true.)

      !allocate (delectromignew(nc,nthreads), stat = ierr)       !MCD
      !delectromignew=0.0d0
      !call checkerr(ierr,'delectromignew',ilog)
      !call memory_monitor(sizeof(delectromignew),'delectromignew',.true.)
      
!c  main variables - intra-aqueous kinetic reactions

      allocate (dtotaq(nc-1,nthreads), stat = ierr)
      dtotaq=0.0d0
      call checkerr(ierr,'dtotaq',ilog)
      call memory_monitor(sizeof(dtotaq),'dtotaq',.true.)

      allocate (totaq(nc-1,nthreads), stat = ierr)
      totaq=0.0d0
      call checkerr(ierr,'totaq',ilog)
      call memory_monitor(sizeof(totaq),'totaq',.true.)

      allocate (totaq_ngi(nc-1,nthreads), stat = ierr)
      totaq_ngi=0.0d0
      call checkerr(ierr,'totaq_ngi',ilog)
      call memory_monitor(sizeof(totaq_ngi),'totaq_ngi',.true.)

!c  main variables - oxidation-reduction

      allocate (dtotor(nc-1), stat = ierr)
      dtotor=0.0d0
      call checkerr(ierr,'dtotor',ilog)
      call memory_monitor(sizeof(dtotor),'dtotor',.true.)

      allocate (totor(nc-1), stat = ierr)
      totor=0.0d0
      call checkerr(ierr,'totor',ilog)
      call memory_monitor(sizeof(totor),'totor',.true.)

!c  main variables - gases

      allocate (totgn(nc-1,nthreads), stat = ierr)
      totgn=0.0d0
      call checkerr(ierr,'totgn',ilog)
      call memory_monitor(sizeof(totgn),'totgn',.true.)

      allocate (totgo(nc-1), stat = ierr)
      totgo=0.0d0
      call checkerr(ierr,'totgo',ilog)
      call memory_monitor(sizeof(totgo),'totgo',.true.)

      allocate (totrateg(nc-1), stat = ierr)
      totrateg=0.0d0
      call checkerr(ierr,'totrateg',ilog)
      call memory_monitor(sizeof(totrateg),'totrateg',.true.)

!c  main variables - sorbed species

      !allocate (totcsn(nc-1), stat = ierr)
      !totcsn=0.0d0
      !call checkerr(ierr,'totcsn',ilog)
      
      allocate (totcsn_ion(nc-1,nthreads), stat = ierr)
      totcsn_ion=0.0d0
      call checkerr(ierr,'totcsn_ion',ilog)
      call memory_monitor(sizeof(totcsn_ion),'totcsn_ion',.true.)
      
      allocate (totcsn_surf(nc-1,nthreads), stat = ierr)
      totcsn_surf=0.0d0
      call checkerr(ierr,'totcsn_surf',ilog)
      call memory_monitor(sizeof(totcsn_surf),'totcsn_surf',.true.)

      !allocate (totcso(nc-1), stat = ierr)
      !totcso=0.0d0
      !call checkerr(ierr,'totcso',ilog)
      
      allocate (totcso_ion(nc-1), stat = ierr)
      totcso_ion=0.0d0
      call checkerr(ierr,'totcso_ion',ilog)
      call memory_monitor(sizeof(totcso_ion),'totcso_ion',.true.)
      
      allocate (totcso_surf(nc-1), stat = ierr)
      totcso_surf=0.0d0
      call checkerr(ierr,'totcso_surf',ilog)
      call memory_monitor(sizeof(totcso_surf),'totcso_surf',.true.)

      allocate (iais(nc), stat = ierr)
      iais=0 
      call checkerr(ierr,'iais',ilog)
      call memory_monitor(sizeof(iais),'iais',.true.)

      allocate (isotherm_type(nc), stat = ierr)
      isotherm_type=' ' 
      call checkerr(ierr,'isotherm_type',ilog) 
      call memory_monitor(sizeof(isotherm_type),'isotherm_type',.true.)

!c  time step control - global system

      allocate (delta_c(n), stat = ierr)
      delta_c=0.0d0
      call checkerr(ierr,'delta_c',ilog)
      call memory_monitor(sizeof(delta_c),'delta_c',.true.)

      allocate (delta_c_max(n), stat = ierr)
      delta_c_max=0.0d0
      call checkerr(ierr,'delta_c_max',ilog)
      call memory_monitor(sizeof(delta_c_max),'delta_c_max',.true.)

!c  newton iteration

      allocate (cinc(nc,nthreads), stat = ierr)
      cinc=0.0d0
      call checkerr(ierr,'cinc',ilog)
      call memory_monitor(sizeof(cinc),'cinc',.true.)

      allocate (dtota(n), stat = ierr)
      dtota=0.0d0
      call checkerr(ierr,'dtota',ilog)
      call memory_monitor(sizeof(dtota),'dtota',.true.)
    
      allocate (dtotc(n,nthreads), stat = ierr)
      dtotc=0.0d0
      call checkerr(ierr,'dtotc',ilog)
      call memory_monitor(sizeof(dtotc),'dtotc',.true.)

      if (hmulti_diff) then
        allocate (dtotcf(n,nthreads), stat = ierr)
        dtotcf=0.0d0
        call checkerr(ierr,'dtotcf',ilog)
        call memory_monitor(sizeof(dtotcf),'dtotcf',.true.)
      end if

      allocate (dtotg(n,nthreads), stat = ierr)
      dtotg=0.0d0
      call checkerr(ierr,'dtotg',ilog)
      call memory_monitor(sizeof(dtotg),'dtotg',.true.)

      !allocate (dtotsb(n), stat = ierr)
      !dtotsb=0.0d0
      !call checkerr(ierr,'dtotsb',ilog)
      
      allocate (dtotsb_ion(n,nthreads), stat = ierr)
      dtotsb_ion=0.0d0
      call checkerr(ierr,'dtotsb_ion',ilog)
      call memory_monitor(sizeof(dtotsb_ion),'dtotsb_ion',.true.)
      
      allocate (dtotsb_surf(n,nthreads), stat = ierr)
      dtotsb_surf=0.0d0
      call checkerr(ierr,'dtotsb_surf',ilog)
      call memory_monitor(sizeof(dtotsb_surf),'dtotsb_surf',.true.)

      allocate (totdp(n,nthreads), stat = ierr)
      totdp=0.0d0
      call checkerr(ierr,'totdp',ilog)
      call memory_monitor(sizeof(totdp),'totdp',.true.)

      allocate (dtotdp(n,nthreads), stat = ierr)
      dtotdp=0.0d0
      call checkerr(ierr,'dtotdp',ilog)
      call memory_monitor(sizeof(dtotdp),'dtotdp',.true.)

      !allocate (totsb(n), stat = ierr)
      !totsb=0.0d0
      !call checkerr(ierr,'totsb',ilog)
      
      allocate (totsb_ion(n), stat = ierr)
      totsb_ion=0.0d0
      call checkerr(ierr,'totsb_ion',ilog)
      call memory_monitor(sizeof(totsb_ion),'totsb_ion',.true.)
      
      allocate (totsb_surf(n), stat = ierr)
      totsb_surf=0.0d0
      call checkerr(ierr,'totsb_surf',ilog)
      call memory_monitor(sizeof(totsb_surf),'totsb_surf',.true.)

      allocate (totcinc(n,nthreads), stat = ierr)
      totcinc=0.0d0
      call checkerr(ierr,'totcinc',ilog)
      call memory_monitor(sizeof(totcinc),'totcinc',.true.)

!c  work arrays - local chemistry

      allocate (alc(n,n,nthreads), stat = ierr)
      alc=0.0d0
      call checkerr(ierr,'alc',ilog)
      call memory_monitor(sizeof(alc),'alc',.true.)

      allocate (blc(n,nthreads), stat = ierr)
      blc=0.0d0
      call checkerr(ierr,'blc',ilog)
      call memory_monitor(sizeof(blc),'blc',.true.)

      allocate (xlc(n,nthreads), stat = ierr)
      xlc=0.0d0
      call checkerr(ierr,'xlc',ilog)
      call memory_monitor(sizeof(xlc),'xlc',.true.)

!c  non-competitive sorption

      allocate (distcoff_lc(nc), stat = ierr)
      distcoff_lc=0.0d0
      call checkerr(ierr,'distcoff_lc',ilog)
      call memory_monitor(sizeof(distcoff_lc),'distcoff_lc',.true.)

      allocate (totan(nc,nthreads), stat = ierr)
      totan=0.0d0 
      call checkerr(ierr,'totan',ilog)
      call memory_monitor(sizeof(totan),'totan',.true.)
     
      allocate (totao(nc), stat = ierr)
      totao=0.0d0 
      call checkerr(ierr,'totao',ilog)
      call memory_monitor(sizeof(totao),'totao',.true.)
    
      allocate (l_nameanc(nc), stat = ierr)
      l_nameanc=0 
      call checkerr(ierr,'l_nameanc',ilog)
      call memory_monitor(sizeof(l_nameanc),'l_nameanc',.true.)
     
      allocate (nameanc(nc), stat = ierr)
      nameanc=' ' 
      call checkerr(ierr,'nameanc',ilog)
      call memory_monitor(sizeof(nameanc),'nameanc',.true.)
      
!c  first order gas decay
      allocate (totgasdecay(n), stat = ierr)
      totgasdecay=0.0d0
      call checkerr(ierr,'totgasdecay',ilog)
      call memory_monitor(sizeof(totgasdecay),'totgasdecay',.true.)

      allocate (dtotgasdecay(n), stat = ierr)
      dtotgasdecay=0.0d0
      call checkerr(ierr,'dtotgasdecay',ilog)
      call memory_monitor(sizeof(dtotgasdecay),'dtotgasdecay',.true.)

!c  first order sorbed components decay
      allocate (totsorptiondecay(nc), stat = ierr)
      totsorptiondecay=0.0d0
      call checkerr(ierr,'totsorptiondecay',ilog)
      call memory_monitor(sizeof(totsorptiondecay),'totsorptiondecay',.true.)

!c  sorbed components decay approach
      allocate (sorptiondecayconst(nc), stat = ierr)
      sorptiondecayconst=0.0d0
      call checkerr(ierr,'sorptiondecayconst',ilog)
      call memory_monitor(sizeof(sorptiondecayconst),'sorptiondecayconst',.true.)

      allocate (sorptiondecayrate(nc), stat = ierr)
      sorptiondecayrate=0.0d0
      call checkerr(ierr,'sorptiondecayrate',ilog)
      call memory_monitor(sizeof(sorptiondecayrate),'sorptiondecayrate',.true.)  
      
!c SIT coefficients, preallocate to avoid memory access error
!c when SIT model is not used
!c moved from mem_rt file to avoid memory access problem for batch reaction
      if (.not. issit) then
        allocate (iasit(1), stat = ierr)
        allocate (jasit(1), stat = ierr)
        allocate (coepsil(1), stat = ierr)
      end if

!cdsu  aqueous decay approach
      allocate (aqdecayconst(nc), stat = ierr)
      aqdecayconst=0.0d0
      call checkerr(ierr,'aqdecayconst',ilog)
      call memory_monitor(sizeof(aqdecayconst),'aqdecayconst',.true.)

      allocate (aqdecayrate(nc), stat = ierr)
      aqdecayrate=0.0d0
      call checkerr(ierr,'aqdecayrate',ilog)
      call memory_monitor(sizeof(aqdecayrate),'aqdecayrate',.true.)

      allocate (daqdecayrate(nc), stat = ierr)
      daqdecayrate=0.0d0
      call checkerr(ierr,'daqdecayrate',ilog)
      call memory_monitor(sizeof(daqdecayrate),'daqdecayrate',.true.)
      
      !c size of aqdecayratetot is n
      allocate (aqdecayratetot(nc), stat = ierr)
      aqdecayratetot=0.0d0
      call checkerr(ierr,'aqdecayratetot',ilog)
      call memory_monitor(sizeof(aqdecayratetot),'aqdecayratetot',.true.)

      allocate (totaqdecay(n), stat = ierr)
      totaqdecay=0.0d0
      call checkerr(ierr,'totaqdecay',ilog)
      call memory_monitor(sizeof(totaqdecay),'totaqdecay',.true.)

      allocate (dtotaqdecay(n), stat = ierr)
      dtotaqdecay=0.0d0
      call checkerr(ierr,'dtotaqdecay',ilog)
      call memory_monitor(sizeof(dtotaqdecay),'dtotaqdecay',.true.)

      return
      end
