!*****Revision Informations Automatically Generated by VisualSVN*****!
!---------------------------------------------------------------------
!> $ID:$
!> $Revision: 826 $
!> $Author: dsu $
!> $Date: 2022-03-24 10:10:16 -0700 (Thu, 24 Mar 2022) $
!> $URL: https://min3psvn.ubc.ca/svn/min3p_thcm/branches/dsu_new_add_2024Jan/src/min3p/porosity_flow.F90 $
!---------------------------------------------------------------------
!********************************************************************!

!c ----------------------------------------------------------------------
!c real*8 function porosity_flow(pornew,porold,delt,pwnew,pwold,stor,porstress,por0,facpormin)
!c ------------------------
!c
!c Compute the new porosity affected by flow processes
!c
!c 
!c ----------------------------------------------------------------------
!cdsu new function of porosity update for the current timestep 
!cdsu including hydromechanical effects
!cdsu ref1: Robert W. Zimmerman, 2017, Pore Volume and Porosity Changes under Uniaxial
!cdsu       Strain Conditions.
!cdsu ref2: Robert Walsh, Nicola Calder and John Avis, A Simple Implementation of 1D
!cdsu       Hydromechanical Coupling in Tough2, Proceedings, Tough Symposium 2012, 
!cdsu       Lawrence Berkeley National Laboratory, Berkeley, California, September 17-19. 
!cdsu       The sign of stress is wrong in this reference.
!cdsu Note: we do not use compressibility directly here.
!cdsu 
!c ----------------------------------------------------------------------

real*8 function porosity_flow(porold,pwnew,pwold,stor,porstress,por0,  &
                              facpormin)
            
implicit none
      
real*8, intent(in) :: porold,pwnew,pwold,stor,porstress,por0,facpormin
     
!c local variables
real*8             :: pormin
real*8, parameter  :: r0 = 0.0d0, r1=1.0d0, small=1.0d-20
      
pormin = facpormin * por0

porosity_flow = porold + stor*(pwnew-pwold) + porstress
      
if (porosity_flow < pormin) then
  porosity_flow = pormin        
else if (porosity_flow >= r1) then
  porosity_flow = r1 - small 
end if     
      
return
end