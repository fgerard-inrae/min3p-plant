!*****Revision Informations Automatically Generated by VisualSVN*****!
!---------------------------------------------------------------------
!> $ID:$
!> $Revision: 869 $
!> $Author: dsu $
!> $Date: 2023-08-18 09:44:21 -0700 (Fri, 18 Aug 2023) $
!> $URL: https://min3psvn.ubc.ca/svn/min3p_thcm/branches/dsu_new_add_2024Jan/src/min3p/rew.F90 $
!---------------------------------------------------------------------
!********************************************************************!

!c -----------------------------------------------------------------------
!c real*8 function rew
!c -----------------------
!c compute reserve of extractible water : used to calculate mean value for alpha-correction method 2
!c
!c written by:      Fred Gï¿½rard - Oct, 07
!c                  alpha function applied to transpiration : REW profile scale used
!c            Introduced in trunk by Celine Blitz Frayret (CBF) - December, 14 2018
!c
!c   definition of variables:
!c
!c I --> on input   * arbitrary  - initialized  + entries expected
!c O --> on output  * arbitrary  - unaltered    + altered
!c                                                                    I O
!c passed:   real*8:
!c           -------
!c           satwnew(nn)        = aqueous phase saturation             + -
!c                                - new time level
!c
!c           integer*4:
!c           ----------
!c           ivol               = pointer to current volume
!c
!c          
!c common:   
!c
!c gen.f     real*8
!c           ------
!c          
!c           integer*4
!c           ------
!c           nn                 = total number of control volumes 
!c           mpropvs(nn)        = pointer array to volume properties              + -
!c
!c phys.f:   real*8:
!c           ------- 
!c           satwlim(nzn)       = water saturation at wilting point   + -
!c           satwfield(nzn)     = water saturation at field capacity  + -
!c
!c local:    rew                = relative extractable water
!c           r1                 = constant
!c           izn                = pointer to material property zone
!c
!c external: -
!c ----------------------------------------------------------------------
 
    real*8 function rew(satwnew,ivol)
 
      use phys, only : rootwateruptake_field, satwlim, satwfield,      &
          satwlim_vol, satwfield_vol
      use gen, only : mpropvs

      implicit none

      real*8 :: satwnew(*)

      integer :: ivol

      !c local variables
      integer :: izn
      real*8 :: satwlim_loc, satwfield_loc

      real*8, parameter :: r1 = 1.0d0


!c  setup pointer to the material properties of the current volume     

      if (rootwateruptake_field) then
        satwlim_loc = satwlim_vol(ivol)
        satwfield_loc = satwfield_vol(ivol)
      else
        izn = mpropvs(ivol)
        satwlim_loc = satwlim(izn)
        satwfield_loc = satwfield(izn)
      end if

!c calculate reserve of extractible water in each control volume

      rew = dmin1((satwnew(ivol)-satwlim_loc)/(satwfield_loc-satwlim_loc),r1)

      return

    end
