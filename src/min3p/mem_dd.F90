!*****Revision Informations Automatically Generated by VisualSVN*****!
!---------------------------------------------------------------------
!> $ID:$
!> $Revision: 826 $
!> $Author: dsu $
!> $Date: 2022-03-24 10:10:16 -0700 (Thu, 24 Mar 2022) $
!> $URL: https://min3psvn.ubc.ca/svn/min3p_thcm/branches/dsu_new_add_2024Jan/src/min3p/mem_dd.F90 $
!---------------------------------------------------------------------
!********************************************************************!

!c -----------------------------------------------------------------------
!c subroutine mem_dd
!c -----------------
!c
!c allocate memory for density-dependant flow simulation
!c
!c written by:          Tom Henderson - August 9, 2002
!c
!c last modified:       Tom Henderson - January 10, 2005
!c
!c definition of variables:
!c
!c I --> on input   * arbitrary  - initialized  + entries expected
!c O --> on output  * arbitrary  - unaltered    + altered
!c                                                                    I O
!c passed:   -
!c
!c common:
!c dens.f:    real*8:
!c           -------
!c           del_p(ncon-1)      = difference in total                 * +       
!c                                pressure potential
!c           del_z(ncon-1)      = difference in                       * +                   
!c                                elevation potential
!c           pressure(nngl)       = fluid pressure                      * +
!c           density(nngl)        = fluid density                       * +
!c           densold(nngl)        = fluid density from previous         * +
!c                                iteration/time step
!c           viscosity(nngl)      = fluid viscosity                     * +
!c           tds_new(nngl)        = total dissolved solids [mg/L]       * +
!c                                at current time step
!c           tds_old(nngl)        =  total dissolved solids [mg/L]      * +
!c                                at previous time step
!c           dcoef(ncon-1)      = coefficient including density,      * +
!c                                viscosity, and relative 
!c                                permeability
!c           ssdens(nngl)         = density of point source fluid       * +
!c
!c           integer*4:
!c           ----------
!c           ilog               = unit number, logbook file           + -
!c
!c local:    integer*4:
!c           ----------
!c           ierr               = 0 -> memory allocation successful
!c
!c external: checkerr  = check for error during memory allocation 
!c---------------------------------------------------------------------- 
!c WARNING
!c---------------------------------------------------------------------- 
!c All allocated variables are initialized to some value. This depends  
!c of its type:
!c 
!c real*8      => 0.0d0
!c integer     => 0 
!c character   => ' '    
!c logical     => .false. 
!c 
!c Sergio Andres Bea Jofre (2009)
!c
!c----------------------------------------------------------------------
  
      subroutine mem_dd
 
      use parm
      use gen
      use dens
      use phys
      
      implicit none
      
      integer :: ierr

      external checkerr
 
!c  main variables - density dependent flow
      allocate (density(nngl), stat = ierr)
      density=1.0d3
      call checkerr(ierr,'density',ilog)
      call memory_monitor(sizeof(density),'density',.true.)


      allocate (densold(nngl), stat = ierr)
      densold=1.0d3
      call checkerr(ierr,'densold',ilog)
      call memory_monitor(sizeof(densold),'densold',.true.)

!      allocate (densold1(nngl), stat = ierr)
!      densold1=1.0d3
!      call checkerr(ierr,'densold',ilog)
!      call memory_monitor(sizeof(densold1),'densold1',.true.)
!
      allocate (densold2(nngl), stat = ierr)
      densold2=1.0d3
      call checkerr(ierr,'densold2',ilog)
      call memory_monitor(sizeof(densold2),'densold2',.true.)


      allocate (viscosity(nngl), stat = ierr)
      viscosity=1.0d-3
      call checkerr(ierr,'viscosity',ilog)
      call memory_monitor(sizeof(viscosity),'viscosity',.true.)


      allocate (tds_new(nngl), stat = ierr)
      tds_new=0.0d0
      call checkerr(ierr,'tds_new',ilog)
      call memory_monitor(sizeof(tds_new),'tds_new',.true.)


      allocate (tds_old(nngl), stat = ierr)
      tds_old=0.0d0
      call checkerr(ierr,'tds_old',ilog)
      call memory_monitor(sizeof(tds_old),'tds_old',.true.)

      allocate (tds_old2(nngl), stat = ierr)
      tds_old2=0.0d0
      call checkerr(ierr,'tds_old2',ilog)
      call memory_monitor(sizeof(tds_old2),'tds_old2',.true.)


      allocate (ssdens(nngl), stat = ierr)
      ssdens=1.0d3
      call checkerr(ierr,'ssdens',ilog)
      call memory_monitor(sizeof(ssdens),'ssdens',.true.)


      if (discretization_type == 0) then
        allocate (del_p(ncon-1), stat = ierr)
        del_p=0.0d0
        call checkerr(ierr,'del_p',ilog)
        call memory_monitor(sizeof(del_p),'del_p',.true.)

        allocate (del_z(ncon-1), stat = ierr)
        del_z=0.0d0
        call checkerr(ierr,'del_z',ilog)
        call memory_monitor(sizeof(del_z),'del_z',.true.)

        allocate (dcoef(ncon-1), stat = ierr)
        dcoef=0.0d0
        call checkerr(ierr,'dcoef',ilog)
        call memory_monitor(sizeof(dcoef),'dcoef',.true.)

#ifdef USG
      else
        allocate (del_p(ncon_usg-1), stat = ierr)
        del_p=0.0d0
        call checkerr(ierr,'del_p',ilog)
        call memory_monitor(sizeof(del_p),'del_p',.true.)

        allocate (del_z(ncon_usg-1), stat = ierr)
        del_z=0.0d0
        call checkerr(ierr,'del_z',ilog)
        call memory_monitor(sizeof(del_z),'del_z',.true.)

        allocate (dcoef(ncon_usg-1), stat = ierr)
        dcoef=0.0d0
        call checkerr(ierr,'dcoef',ilog)
        call memory_monitor(sizeof(dcoef),'dcoef',.true.)
#endif
      end if
      
      allocate (modify_por(nngl), stat = ierr)
      modify_por=.false. 
      call checkerr(ierr,'modify_por',ilog)
      call memory_monitor(sizeof(modify_por),'modify_por',.true.)

      return
      end
