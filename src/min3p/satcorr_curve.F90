!*****Revision Informations Automatically Generated by VisualSVN*****!
!---------------------------------------------------------------------
!> $ID:$
!> $Revision: 786 $
!> $Author: dsu $
!> $Date: 2021-01-06 21:41:32 -0800 (Wed, 06 Jan 2021) $
!> $URL: https://min3psvn.ubc.ca/svn/min3p_thcm/branches/dsu_new_add_2024Jan/src/min3p/satcorr_curve.F90 $
!---------------------------------------------------------------------
!********************************************************************!

!c ----------------------------------------------------------------------
!c subroutine satcorr_curve
!c -------------------
!c
!c compute saturation correction for reaction rate based on sigmodial curve
!c 
!c
!c written by:      Danyang Su - Jul 19, 2018
!c
!c last modified:   Danyang Su - Jul 19, 2018
!c
!c definition of variables:
!c
!c I --> on input   * arbitrary  - initialized  + entries expected
!c O --> on output  * arbitrary  - unaltered    + altered
!c                                                                    I O
!c passed:   real*8:
!c           -------
!c           swt                    = saturation                      + -
!c
!c
!c           satcorr                = saturation correction           * +
!c
!c gen file
!c           real*8:
!c           rate_satcorr_a         = parameter a of water freezing 
!c                                    saturation correction 
!c                                    r=d+(a-d)(1+((x+2)/c)^b)
!c
!c           rate_satcorr_b         = parameter b of water freezing 
!c                                    saturation correction 
!c                                    r=d+(a-d)(1+((x+2)/c)^b)
!c
!c           rate_satcorr_c         = parameter c of water freezing 
!c                                    saturation correction 
!c                                    r=d+(a-d)(1+((x+2)/c)^b)
!c
!c           rate_satcorr_d         = parameter d of water freezing 
!c                                    saturation correction 
!c                                    r=d+(a-d)(1+((x+2)/c)^b)
!c
!c           rate_satcorr_satmin
!c                                  = lower limitation of saturation 
!c                                    for the curve
!c
!c           rate_satcorr_satmax
!c                                  = upper limitation of saturation 
!c                                    for the curve
!c
!c           rate_satcorr_min
!c                                  = lower limitation of water 
!c                                    saturation correction
!c
!c           rate_satcorr_max
!c                                  = upper limitation of water 
!c                                    saturation correction
!c           logical:
!c           --------
!c           b_rate_satcorr  
!c                                 = if true, use water freezing 
!c                                    saturation correction for reaction rate
!c
!c      
!c
!c          example
!c          curve fitting tool https://mycurvefit.com/
!c          'water freezing relative conductivity curve'
!c          0.01273  22.47  2.002  1.002  ;parameter a, b, c and d for relative conductivity curve relcond=d+(a-d)/(1.0+((temperatureC+2.0)/c)^b)
!c          -1.0     1.0    0.01   1.0    ;minimum temperature, maximum temperature, minimum relcond, maximum relcond
!c ----------------------------------------------------------------------
 
      function satcorr_curve(sat) result(satcorr)
    
        use gen, only:  rate_satcorr_a        ,&
                        rate_satcorr_b        ,&
                        rate_satcorr_c        ,&
                        rate_satcorr_d        ,&
                        rate_satcorr_satmax   ,&
                        rate_satcorr_satmin   ,&
                        rate_satcorr_min      ,&
                        rate_satcorr_max
  
        implicit none  
  
        real*8, intent(in) :: sat
        real*8 :: satcorr
      
        satcorr = 1.0d0
      
        if (sat > rate_satcorr_satmax)then
          satcorr = rate_satcorr_min
        else if (sat < rate_satcorr_satmin) then
          satcorr = rate_satcorr_max
        else 
          satcorr = rate_satcorr_d +                         &
                    (rate_satcorr_a - rate_satcorr_d)/       &
                    (1.0d0 + ((3.0d0-sat)/rate_satcorr_c)**  &
                    rate_satcorr_b)
          if (satcorr < rate_satcorr_min) then
            satcorr = rate_satcorr_min
          else if (satcorr > rate_satcorr_max) then
            satcorr = rate_satcorr_max
          end if     
        end if 
      
      end function satcorr_curve