!*****Revision Informations Automatically Generated by VisualSVN*****!
!---------------------------------------------------------------------
!> $ID:$
!> $Revision: 879 $
!> $Author: dsu $
!> $Date: 2024-02-17 10:15:21 -0800 (Sat, 17 Feb 2024) $
!> $URL: https://min3psvn.ubc.ca/svn/min3p_thcm/branches/dsu_new_add_2024Jan/src/min3p/biol.F90 $
!---------------------------------------------------------------------
!********************************************************************!
    module biol

      use parm

!c ----------------------------------------------------------------------
!c Celine Blitz Frayret (CBF) for Frederic Gerard, December 14, 2018
!c Parametres related to root water uptake :
!c ------------------------
!c        -->                                                         <--
!c           real*8:
!c           -------        
!c           qroot(nn)     = root water uptake for current
!c                               control volume
!c           qrootinc(nn)   = root water uptake for current
!c                              control volume (incremented)
!c           dqroot(nn)     = derivative of root water uptake
!c     rootlengthdens(nzn)= root length density read from *.dat file
!c     rld(nn)            = root length density
!c     canopy_evap_factor = efficiency factor for canopy evaporation
!c           pet                = potential evapotranspiration
!c           pe_soil            = potential soil evaporation
!c           canopy_int         = canopy interception
!c     scale_tree_growth  = scale factor to account for the influence
!c     solar_ratio= ratio between the solar energy at the forest
!c  floor and this above tree canopy
!c           time_soi           = next read time for soil specific
!c                                 parameters
!c           uptakefactor(nzn)  = passive uptake factor (by zone)
!c           p1(nzn)            = fitting parameter for root water
!c                                  uptake function
!c     time_rld= time at which RLD are updated ! CBF RLD
!c     time_io_prec= previous time step ! CBF RLD
!c     arld= value of one of the rld model parameters ! CBF RLD
!c     brld= value of one of the rld model parameters ! CBF RLD
!c     crld= value of one of the rld model parameters ! CBF RLD
!c     drld= value of one of the rld model parameters ! CBF RLD
!c
!c
!c           integer*4:
!c           ----------
!c     cmws              = computing method for water stress             * +
!c
!c           logical:
!c           --------
!c  (when root_uptake = false) CBF
!c           pure_evap   = .true.  -> physical evaporation only CBF
!c           vegetation_growth = .true. -> account for the effect of vegetation growth
!c           rootlengthdens_field = .true. -> read root length density field
!c           coupled_as = .true. -> update root length density by coupling with ArchiSimple software ! CBF RLD
!c           coupled_rt = .true. -> update root length density by coupling with RootTyp software ! CBF RLD RLD
!c     inside_rld= .true. -> update root length density by a law inside updtrootdensity ! CBF RLD
!c     rootdensitynill= .true. -> when root density length equal to zero
!c           BINev(nn)      = binary matrix of track control volume
!c                              subjected to evaporation
!c           BINT(nn)       = binary matrix of track control volume
!c                              subjected to transpiration
!c        -->                                                         <--
!c ----------------------------------------------------------------------


      real (type_r8) :: pet
      real (type_r8) :: pe_soil
      real (type_r8) :: tpot  !FG August 2021
      real (type_r8) :: canopy_int
      real (type_r8) :: time_soi
      real (type_r8) :: scale_tree_growth
      real (type_r8) :: solar_ratio
      real (type_r8) :: canopy_evap_factor
      real (type_r8) :: time_rld ! CBF RLD
      real (type_r8) :: time_io_prec ! CBF RLD
      real (type_r8) :: arld ! CBF RLD
      real (type_r8) :: brld ! CBF RLD
      real (type_r8) :: crld ! CBF RLD
      real (type_r8) :: drld ! CBF RLD

!c DSU the variable qroot, qrootinc and dqroot are not necesary
!c DSU to declared as volume dependent variables as they are used
!c locally only in jacobian matrix assembly
!c      real (type_r8), allocatable :: qroot(:)
!c      real (type_r8), allocatable :: qrootinc(:)
!c      real (type_r8), allocatable :: dqroot(:)

      real (type_r8), allocatable :: p1(:)
      real (type_r8), allocatable :: rootlengthdens(:)
      real (type_r8), allocatable :: rld(:)
      real (type_r8), allocatable :: uptakefactor(:)
     
      real (type_r8), allocatable :: resprate(:,:)           !units mol/(root length * time)

!cdsu minimum aqueous concentration required to activate solute uptake
      real (type_r8), allocatable :: totc_uptake_min(:,:)    !units mol/(L water) 

      integer :: cmws

!cdsu leaf recycling parameters
!cdsu number of component-mineral pair, one component can be paired to different minerals
      integer :: nrcm
      integer, allocatable :: iarcm(:)
      integer, allocatable :: jarcm(:)
!cdsu distribution coefficient of component to different minerals in different zones.
!cdsu the total distribution coefficient should not exceed one.
      real (type_r8), allocatable :: rcm_distri_coeff(:,:)
!cdsu stoichiometric coefficient of component to different minerals.
      real (type_r8), allocatable :: rcm_xnum_coeff(:)
!cdsu number of recycle component-mineral time and zone series
      integer :: nrcm_tz 
      integer :: nrcm_nc
      integer :: nrcm_nm

!cdsu indicate the component and mineral are part of recyclable pair
      logical, allocatable :: rcmpair_c(:)
      logical, allocatable :: rcmpair_m(:)

!cdsu type of mineral returned zone
      integer, allocatable :: rcm_zone_type(:)
!cdsu return time series
      real (type_r8), allocatable :: rcm_time(:,:)
!cdsu return zone series    
      real (type_r8), allocatable :: rcm_zone(:,:,:)
 
      logical :: vegetation_growth
      logical :: pure_evap
      logical :: rootlengthdens_field
      logical :: rootdensitynill
      logical :: coupled_as ! CBF RLD
      logical :: coupled_rt ! CBF RLD
      logical :: inside_rld ! CBF RLD
      !logical, allocatable :: BINev(:)
      !logical, allocatable :: BINT(:)

!c DSU update root density from file
      integer :: irld
      logical :: rld_field_update
      integer :: rld_update_num, rld_update_index
      real(type_r8), allocatable :: rld_update_time(:)

! HG addition for passive solute uptake function 7 Feb 2019
! --------------------------
!        -->                                                         <--
!
!           logical:
!           --------
!           root_uptake        = .true. ->  compute root water       * +
!                                           and passive/rejective
!                                           solute uptakes
!           vegetation growth  = .true   -> account for the effect of vegetation growth
!                                           on water uptake vs. physical evaporation 
!           passive_uptake     = .true.  -> calculate passive solute
!
!-----------------------------------------------------------------------------------------

    logical :: passive_uptake

    end module biol
