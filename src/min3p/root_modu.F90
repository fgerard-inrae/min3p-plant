!*****Revision Informations Automatically Generated by VisualSVN*****!
!---------------------------------------------------------------------
!> $ID:$
!> $Revision: 879 $
!> $Author: dsu $
!> $Date: 2024-02-17 10:15:21 -0800 (Sat, 17 Feb 2024) $
!> $URL: https://min3psvn.ubc.ca/svn/min3p_thcm/branches/dsu_new_add_2024Jan/src/min3p/root_modu.F90 $
!---------------------------------------------------------------------
!********************************************************************!

!> module: root_modu
!>
!> written by: Danyang Su
!>
!> module description:
!>   interface to call ArchiSimple.cpp functions
!> Note:  
!>   
!> 

#ifdef ARCHISIMPLE
    module root_modu
          
      use, intrinsic :: ISO_C_BINDING
      
!c ------------------------------------------------------------------------
!c Celine Blitz Frayret (CBF) for Frederic Gerard, Oct 10, 2018
!c Parametres related to coupling to ArchiSimple and Root Typ :
!c ------------------------------------------------------------------------
!c         real:
!c         -----
!c         RSD_coupled(nn)    = RLD array passed during coupling and assigned to rld(nn)
!c         x_g(nn)        = x coordinate, same as xg but declared here for coupling
!c         y_g(nn)        = y coordinate, same as yg but declared here for coupling
!c         z_g(nn)        = z coordinate, same as zg but declared here for coupling
!c ------------------------------------------------------------------------

      real(kind=C_DOUBLE),dimension(:),allocatable,target::RSD_coupled
      real(kind=C_FLOAT),dimension(:),allocatable,target::x_g
      real(kind=C_FLOAT),dimension(:),allocatable,target::y_g
      real(kind=C_FLOAT),dimension(:),allocatable,target::z_g

      interface 

      ! ARCHISIMPLE initiation :
      subroutine INIT_ARCHI(directory,seed,pos,x,y,z) BIND(C,NAME="INIT_ARCHI")
        import C_CHAR, C_INT, C_DOUBLE
        character(kind=C_CHAR) :: directory(*)
        integer(kind=C_INT), VALUE :: seed
        integer(kind=C_INT), VALUE :: pos
        real(kind=C_DOUBLE), VALUE:: x,y,z
      end subroutine INIT_ARCHI

      ! ROOT TYP initiation :
      subroutine INIT_ROOTTYP(directory,seed,pos,x,y,z) BIND(C,NAME="INIT_ROOTTYP")
        import C_CHAR, C_INT, C_DOUBLE
        character(kind=C_CHAR) :: directory(*)
        integer(kind=C_INT), VALUE :: seed
        integer(kind=C_INT), VALUE :: pos
        real(kind=C_DOUBLE), VALUE:: x,y,z
      end subroutine INIT_ROOTTYP

      ! Root upscaling factor for X, Y and Z directions.
      subroutine SetRootUpscaleFactor(fact_x,fact_y,fact_z) BIND(C,NAME="SetRootUpscaleFactor")
        import C_DOUBLE
        real(kind=C_DOUBLE), VALUE::fact_x,fact_y,fact_z
      end subroutine SetRootUpscaleFactor

      ! ARCHISIMPLE computation :
      ! DSU, fixed bug in augument definition, passing 13 auguments to COMP_AS in the old version
      ! while the acutally number of argument in COMP_AS is 12; arguments order is modified
      ! Old subroutine COMP_AS(flag,time,delt,zmax,nvz,ymax,nvy,xmax,nvx,rsd,x_g,y_g,z_g,tmax)BIND(C,NAME="COMP_AS")
      subroutine COMP_AS(flag,time,delt,nvx_gbl,nvy_gbl,nvz_gbl,       &
                         nvx,nvy,nvz,xg,yg,zg,rsd,xmax,ymax,zmax,tmax) &
                         BIND(C,NAME="COMP_AS")
        import C_DOUBLE, C_PTR, C_INT, C_FLOAT
        real(kind=C_DOUBLE), VALUE::time,xmax,ymax,zmax
        real(kind=C_FLOAT), VALUE::delt
        integer(kind=C_INT), VALUE::flag,nvx_gbl,nvy_gbl,nvz_gbl,      &
                                    nvx,nvy,nvz,tmax
        type(C_PTR),VALUE :: rsd,xg,yg,zg
      end subroutine COMP_AS
      
      ! ROOT TYP computation :
      subroutine COMP_RT(time,delt,nvx_gbl,nvy_gbl,nvz_gbl,            &
                         nvx,nvy,nvz,xg,yg,zg,rsd,xmax,ymax,zmax)      &
                         BIND(C,NAME="COMP_RT")
        import C_DOUBLE, C_PTR, C_INT, C_FLOAT
        real(kind=C_DOUBLE), VALUE::time, xmax, ymax, zmax
        real(kind=C_FLOAT), VALUE::delt
        integer(kind=C_INT), VALUE:: nvx_gbl, nvy_gbl, nvz_gbl, nvx, nvy, nvz
        type(C_PTR),VALUE :: rsd, xg, yg, zg
      end subroutine COMP_RT

      ! ROOT TYP finalization :
      subroutine END_ROOTTYP()BIND(C,NAME="END_ROOTTYP")
      end subroutine END_ROOTTYP

      ! ARCHISIMPLE finalization :
      subroutine END_ARCHI()BIND(C,NAME="END_ARCHI")
      end subroutine END_ARCHI
       
      end interface
        
    end module root_modu
#endif
