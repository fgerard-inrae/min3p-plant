!*****Revision Informations Automatically Generated by VisualSVN*****!
!---------------------------------------------------------------------
!> $ID:$
!> $Revision: 875 $
!> $Author: dsu $
!> $Date: 2024-01-21 12:55:48 -0800 (Sun, 21 Jan 2024) $
!> $URL: https://min3psvn.ubc.ca/svn/min3p_thcm/branches/dsu_new_add_2024Jan/src/min3p/cputime_pc.F90 $
!---------------------------------------------------------------------
!********************************************************************!

!c ----------------------------------------------------------------------
!c real*8 function cputime
!c ------------------------
!c
!c determine cputime
!c
!c written by:      Uli Mayer - September 28, 2000
!c
!c last modified:
!c
!c definition of variables:
!c
!c I --> on input   * arbitrary  - initialized  + entries expected
!c O --> on output  * arbitrary  - unaltered    + altered
!c                                                                    I O
!c passed:   real*8:
!c           -------
!c           cputime          = cpu-time                              * +
!c
!c common:   -
!c 
!c local:    time             = cpu-time in seconds 
!c
!c external: cpu_time  = returns cpu-time in seconds
!c ----------------------------------------------------------------------

!> Determine cputime
!> Note: fortran internal function cpu_time is the total cpu time of all threads of a process.
!> For multi-threaded process (e.g., openmp), use omp_get_wtime instead.
      real*8 function cputime()

#ifdef PETSC
#include <petscversion.h>
#if (PETSC_VERSION_MAJOR >= 3 && PETSC_VERSION_MINOR >= 8)
#include <petsc/finclude/petscsys.h>
      use petscsys
#endif
#endif

#ifdef OPENMP
      use omp_lib      
#endif  

      implicit none
#ifdef PETSC
#if (PETSC_VERSION_MAJOR >= 3 && PETSC_VERSION_MINOR >= 6 && PETSC_VERSION_MINOR < 8)
#include <petsc/finclude/petscsys.h>
#elif (PETSC_VERSION_MAJOR >= 3 && PETSC_VERSION_MINOR < 6)
#include <finclude/petscsys.h>
#endif
#endif


      real*8 time
#ifndef OPENMP
#ifndef PETSC
      integer :: count, count_rate, count_max
#endif
#endif

!c  Visual Fortran intrinsic functions
!
!cintellinux *** replace by compiler specific function ***
#ifdef OPENMP
      cputime = omp_get_wtime()
#elif PETSC
      cputime = MPI_Wtime()
#else
      call cpu_time(time)
      cputime = time

      !cpu_time() is compiler specific, the norm is milliseconds, low precision.

      !use wall clock time to get a higher precision time. DSU, 2014-04-04
      !call system_clock(count, count_rate, count_max)
      !cputime = real(count)/real(count_rate)
#endif 
      return
      end
