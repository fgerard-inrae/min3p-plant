!*****Revision Informations Automatically Generated by VisualSVN*****!
!---------------------------------------------------------------------
!> $ID:$
!> $Revision: 826 $
!> $Author: dsu $
!> $Date: 2022-03-24 10:10:16 -0700 (Thu, 24 Mar 2022) $
!> $URL: https://min3psvn.ubc.ca/svn/min3p_thcm/branches/dsu_new_add_2024Jan/src/dgm/read_tau.F90 $
!---------------------------------------------------------------------
!********************************************************************!

!>
!> this code is deprecated. If the gas tortuosity is different from aqueous phase,
!> please use 'read gas tortuosity field from file' or 'assigned tau' to
!> read gas tortuosity
!> by DSU, 2018-11-13
!>
      subroutine read_tau
    
      use gen
      use file_unit, only : lun_get, lun_free
#ifdef PETSC
      use petsc_mpi_common, only : petsc_mpi_finalize
#endif
      
      implicit none
      
      external relpfsat, relpfsat_g
      
      character*1 cdummy
      real*8 :: rdummy
      integer :: igvs, ivol, ivolgbl, iskip, nskip
      
!c      real*8      taugas(nn)
      
      igvs = lun_get()
      
      open(igvs,file=prefix(:l_prfx)//'.gvs',status='unknown',         &
           form='formatted')
      
      if(rank == 0 .and. b_enable_output) then    
        write(ilog,'(/a)') ' read gas tortuosity values from file'
      end if
      
!c       ignore first 3 lines
      read(igvs,*,err=998,end=998) cdummy
      read(igvs,*,err=998,end=998) cdummy
      read(igvs,*,err=998,end=998) cdummy
      
#ifdef USG
      if (discretization_type > 0) then
        do ivolgbl = 1,nngbl

#ifdef PETSC
          if (ibits(usg_mesh_ordering,0,2) == 3) then
            ivol = node_idx_g2lg(node_idx_g2g_invord(ivolgbl))
          else
            ivol = node_idx_g2lg(ivolgbl)
          end if
#else
          if (ibits(usg_mesh_ordering,0,2) == 3) then
            ivol = node_idx_g2g_invord(ivolgbl)
          else
            ivol = ivolgbl
          end if
#endif

          if (ivol > 0) then
            read(igvs,*,err=998,end=998) rdummy, rdummy, rdummy,       &
                                         taugas(ivol)
          else
            read(igvs,*,err=998,end=998) rdummy
          end if
        end do
      end if
#endif

      if (discretization_type == 0) then
        nskip = 0
        do ivol = 1,nngl
#ifdef   PETSC
          do iskip = 1, node_idx_lg2g(ivol) - nskip -1
              read(igvs,*,end=998,err=998) rdummy
          end do
          nskip = node_idx_lg2g(ivol)
#endif
          read(igvs,*,err=998,end=998) rdummy, rdummy, rdummy,         &
                                       taugas(ivol)
        end do
      end if

      close (igvs)
      call lun_free(igvs)
    
      goto 1000

998   continue
      if (rank == 0) then
        write(ilog,*) 'SIMULATION TERMINATED'
        write(ilog,*) 'error reading nodal gas tortuosity field ',     &
                      'from file'
        write(ilog,*) 'subroutine read_tau'
      end if
      close(ilog)
#ifdef PETSC
      call petsc_mpi_finalize
#endif
      stop

1000  return
      end


      
